#!/usr/bin/env python
import defopt
from pathlib import Path
import json
import os.path


def prep(config: Path):
    """
    Prepare
    :param config: configuration file
    """
    # read the config file
    with config.open('r') as f:
        meta = json.load(f)

    # runs some checks
    if not "project_dir" in meta:
        raise RuntimeError("need to have a project directory")
    if not os.path.isdir(meta["project_dir"]):
        raise RuntimeError(f"file {meta['project_dir']} is not a directory")
    if not "output_dir" in meta:
        raise RuntimeError("need to have an output directory")

    # create the output directory
    p = Path(meta['output_dir'])
    p.mkdir(parents=True)


def run(config: Path, nprocs: int=1):
    """
    Run
    :param config: configuration file
    :param nprocs: number of processes
    """
    # read the config file
    with config.open('r') as f:
        meta = json.load(f)

    # create the SWATPlusR scripts

    # create the SLURM scripts



def analyse(config: Path):
    """
    Analyse the results
    :param config: configuration file
    """
    pass


if __name__ == '__main__':
    defopt.run([prep, run, analyse])
